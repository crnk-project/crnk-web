<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>Crnk Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Crnk Documentation</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_architecture">1. Architecture</a></li>
<li><a href="#_setup">2. Setup</a>
<ul class="sectlevel2">
<li><a href="#_requirements">2.1. Requirements</a></li>
<li><a href="#_integration_with_jax_rs">2.2. Integration with JAX-RS</a>
<ul class="sectlevel3">
<li><a href="#_crnkfeature">2.2.1. CrnkFeature</a></li>
<li><a href="#_exception_mapping_for_jax_rs_services">2.2.2. Exception mapping for JAX-RS services</a></li>
<li><a href="#_return_resources_with_jax_rs_services">2.2.3. Return resources with JAX-RS services</a></li>
<li><a href="#_jax_rs_interoperability">2.2.4. JAX-RS interoperability</a></li>
</ul>
</li>
<li><a href="#_integration_with_servlet_api">2.3. Integration with Servlet API</a>
<ul class="sectlevel3">
<li><a href="#_integrating_using_a_servlet">2.3.1. Integrating using a Servlet</a></li>
<li><a href="#_integrating_using_a_filter">2.3.2. Integrating using a filter</a></li>
</ul>
</li>
<li><a href="#_integration_with_spring">2.4. Integration with Spring</a></li>
<li><a href="#_discovery_with_cdi">2.5. Discovery with CDI</a></li>
<li><a href="#_discovery_with_spring">2.6. Discovery with Spring</a></li>
<li><a href="#_discovery_without_a_dependency_injection_framework">2.7. Discovery without a dependency injection framework</a></li>
<li><a href="#_no_discovery">2.8. No Discovery</a></li>
<li><a href="#_crnkboot">2.9. CrnkBoot</a></li>
<li><a href="#_parameters">2.10. Parameters</a></li>
</ul>
</li>
<li><a href="#_resource">3. Resource</a>
<ul class="sectlevel2">
<li><a href="#_jsonapiresource">3.1. JsonApiResource</a></li>
<li><a href="#_jsonapiid">3.2. JsonApiId</a></li>
<li><a href="#_jsonapirelation">3.3. JsonApiRelation</a></li>
<li><a href="#_jsonapimetainformation">3.4. JsonApiMetaInformation</a></li>
<li><a href="#_jsonapilinksinformation">3.5. JsonApiLinksInformation</a></li>
</ul>
</li>
<li><a href="#_repositories">4. Repositories</a>
<ul class="sectlevel2">
<li><a href="#_resourcerepositoryv2">4.1. ResourceRepositoryV2</a></li>
<li><a href="#_relationshiprepositoryv2">4.2. RelationshipRepositoryV2</a></li>
<li><a href="#_bulkrelationshiprepositoryv2">4.3. BulkRelationshipRepositoryV2</a></li>
<li><a href="#_resourcelist">4.4. ResourceList</a></li>
<li><a href="#_query_parameters_with_queryspec">4.5. Query parameters with QuerySpec</a>
<ul class="sectlevel3">
<li><a href="#_filtering">4.5.1. Filtering</a></li>
<li><a href="#_sorting">4.5.2. Sorting</a></li>
<li><a href="#_pagination">4.5.3. Pagination</a></li>
<li><a href="#_sparse_fieldsets">4.5.4. Sparse Fieldsets</a></li>
<li><a href="#_inclusion_of_related_resources">4.5.5. Inclusion of Related Resources</a></li>
<li><a href="#_api">4.5.6. API</a></li>
<li><a href="#_defaultqueryspecdeserializer">4.5.7. DefaultQuerySpecDeserializer</a></li>
</ul>
</li>
<li><a href="#_error_handling">4.6. Error Handling</a>
<ul class="sectlevel3">
<li><a href="#_throwing_an_exception">4.6.1. Throwing an exception&#8230;&#8203;</a></li>
<li><a href="#__and_mapping_it_to_json_api_response">4.6.2. &#8230;&#8203;and mapping it to JSON API response</a></li>
</ul>
</li>
<li><a href="#_meta_information">4.7. Meta Information</a></li>
<li><a href="#_links_information">4.8. Links Information</a></li>
</ul>
</li>
<li><a href="#_client">5. Client</a>
<ul class="sectlevel2">
<li><a href="#_usage">5.1. Usage</a></li>
<li><a href="#_type_safety">5.2. Type-Safety</a></li>
<li><a href="#_jax_rs_interoperability_2">5.3. JAX-RS interoperability</a></li>
<li><a href="#_http_customization">5.4. HTTP customization</a></li>
</ul>
</li>
<li><a href="#_modules">6. Modules</a>
<ul class="sectlevel2">
<li><a href="#_jpa_module">6.1. JPA Module</a>
<ul class="sectlevel3">
<li><a href="#_jpa_setup">6.1.1. JPA Setup</a></li>
<li><a href="#_criteria_api_and_querydsl">6.1.2. Criteria API and QueryDSL</a></li>
<li><a href="#_customizing_the_jpa_repository">6.1.3. Customizing the JPA repository</a></li>
<li><a href="#_dto_mapping">6.1.4. DTO Mapping</a></li>
</ul>
</li>
<li><a href="#_jsr_303_validation_module">6.2. JSR 303 Validation Module</a></li>
<li><a href="#_tracing_with_zipkin_brave">6.3. Tracing with Zipkin/Brave</a></li>
<li><a href="#_security_module">6.4. Security Module</a></li>
<li><a href="#_meta_module">6.5. Meta Module</a></li>
<li><a href="#_home_module">6.6. Home Module</a></li>
<li><a href="#_operations_module">6.7. Operations Module</a></li>
<li><a href="#_ui_module">6.8. UI Module</a></li>
</ul>
</li>
<li><a href="#_module_development">7. Module Development</a>
<ul class="sectlevel2">
<li><a href="#_request_filtering">7.1. Request Filtering</a></li>
<li><a href="#_integrate_third_party_data_stores">7.2. Integrate third-party data stores</a></li>
<li><a href="#_implement_a_custom_discovery_mechanism">7.3. Implement a custom discovery mechanism</a></li>
<li><a href="#_let_a_module_hook_into_the_crnk_http_client_implementation">7.4. Let a module hook into the Crnk HTTP client implementation</a></li>
<li><a href="#_implement_a_custom_integration">7.5. Implement a custom integration</a></li>
</ul>
</li>
<li><a href="#_generation">8. Generation</a>
<ul class="sectlevel2">
<li><a href="#_typescript">8.1. Typescript</a></li>
</ul>
</li>
<li><a href="#_faq">9. FAQ</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Crnk is an implementation of the JSON API specification and recommendations in Java. It allows you to rapidly
build REST APIs without having to worry about lower protocol details and lets you instead
focus on your application. JSON API and Crnk come with support for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>client and server implementation (with a focus on the later).</p>
</li>
<li>
<p>standardized url handling such as <code>/api/persons?filter[title]=John</code> and <code>/api/persons/{id}</code></p>
</li>
<li>
<p>sorting, filtering, paging of resources</p>
</li>
<li>
<p>attaching link and meta information to data.</p>
</li>
<li>
<p>inserting, updating and deleting of resources.</p>
</li>
<li>
<p>support to request complex object graphs in a single request with JSON API inclusions.</p>
</li>
<li>
<p>support for partial objects with sparse field sets.</p>
</li>
<li>
<p>atomically create, update and delete multiple with <a href="http://jsonpatch.com/">jsonpatch.com</a>.</p>
</li>
<li>
<p>a flexible module API to choose and extend the feature set of Crnk.</p>
</li>
<li>
<p>eased testing with the client implementation providing type-safe stubs to access server repositories.</p>
</li>
<li>
<p>repositories providing runtime/meta information about Crnk to implement, for example, documentation
and UI automation.</p>
</li>
<li>
<p>generation of type-safe client stubs (currently Typescript as target language implemented)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Next to that Crnk supports many popular frameworks and APIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CDI: resolve repositories and extensions with CDI.</p>
</li>
<li>
<p>Spring: run Crnk with Spring, including support for Spring Boot, Spring ORM and Spring Security.</p>
</li>
<li>
<p>Servlet API: run Crnk as servlet.</p>
</li>
<li>
<p>JAXRS: run Crnk as feature.</p>
</li>
<li>
<p>JPA: expose entities as JSON API resources.</p>
</li>
<li>
<p>bean validation: properly marshal validation and constraints exceptions.</p>
</li>
<li>
<p>Zipkin: trace all your calls.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architecture">1. Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Resources</strong> and <strong>repositories</strong> are the main object types in use by Crnk. Those types closely reflect the
JSON API specification. Resources hold the data; while repositories implement the access to those resources. A
running Crnk application can have any number of those repositories which may or may not be related. To establish
such relations, there is a further distinction between <strong>resource repositories</strong> and <strong>relationship repositories</strong>.</p>
</div>
<div class="paragraph">
<p>The <code>crnk-core</code> project hosts a <code>engine</code> package that provides an implementation of the JSON API specification.
It processes incoming requests and makes the appropriate calls to repositories. A single request may make one or multiple calls
 to repositories. Multiple
repository are called when the request asks for inclusions of related resoures where the main repository chooses
to not directly handle those inclusions by itself (explained in detail in later chapters). In the background
the engine takes care of details like serialization, repository lookup and error handling. For this
to work it offers a module API to customize and extend the Crnk feature set. The engine
does not dictate how resources and repositories are implemented. It makes use of a more abstract
information model and adapters to forward call to a particular implementation. This allows for a lot of flexibility
in the repository design. In many cases users will make use of annotations and interfaces provided by <code>crnk-core</code>
which follow the specification and recommendations of JSON API. But there is also the possibility to implement
repositories in other fashions like it has been done in <code>crnk-jpa</code>.</p>
</div>
<div class="paragraph">
<p>The subsequent chapters explain how to setup and use Crnk.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup">2. Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two main, orthogonal aspects of Crnk that need configuration:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The integration into a web framework like JAXRS or the Servlet API to be able to process requests.</p>
</li>
<li>
<p>The discovery of repositories, modules, exception mappers, etc.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The subsequent sections explain various possiblities resp. how to implement an own one.</p>
</div>
<div class="sect2">
<h3 id="_requirements">2.1. Requirements</h3>
<div class="paragraph">
<p>Crnk library requires minimum Java 7 to build and run.</p>
</div>
</div>
<div class="sect2">
<h3 id="_integration_with_jax_rs">2.2. Integration with JAX-RS</h3>
<div class="paragraph">
<p>Crnk allows integration with JAX-RS environments through the usage of JAX-RS specification. JAX-RS 2.0 is
required for this integration. Under the hood there is a @PreMatching filter which checks each request for
JSON API processing. The Setup can look as simple as:</p>
</div>
<div class="sect3">
<h4 id="_crnkfeature">2.2.1. CrnkFeature</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>@ApplicationPath("/")
	public class MyApplication extends Application {

		@Override
		public Set&lt;Object&gt; getSingletons() {
			CrnkFeature crnkFeature = new CrnkFeature();
			return Collections.singleton((Object)crnkFeature);
		}
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CrnkFeature</code> provides various accessors to customize the behavior of Crnk.
A more advanced setup may look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	public class MyAdvancedCrnkFeature implements Feature {

		@Inject
		private EntityManager em;

		@Inject
		private EntityManagerFactory emFactory;

		...

		@Override
		public boolean configure(FeatureContext featureContext) {
			// also map entities to JSON API resources (see further below)
			JpaModule jpaModule = new JpaModule(emFactory, em, transactionRunner);
			jpaModule.setRepositoryFactory(new ValidatedJpaRepositoryFactory());

			// JSON API compliant URL handling with QuerySpec
			DefaultQuerySpecDeserializer querySpecDeserializer = new DefaultQuerySpecDeserializer();

			// limit all incoming requests to 20 resources if not specified otherwise
			querySpecDeserializer.setDefaultLimit(20L);

			ServiceLocator serviceLocator = ...
			CrnkFeature feature = new CrnkFeature(new ObjectMapper(), querySpecDeserializer, serviceLocator);
			feature.addModule(jpaModule);

			featureContext.register(feature);
			return true;
		}
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that depending on the discovery mechanism in use (like Spring or CDI), modules like this JpaModule can be picked
up automatically.</p>
</div>
</div>
<div class="sect3">
<h4 id="_exception_mapping_for_jax_rs_services">2.2.2. Exception mapping for JAX-RS services</h4>
<div class="paragraph">
<p>In many cases Crnk repositories are used along regular JAX-RS services. In such scenarios it can be worthwhile
if Crnk repositories and JAX-RS services make use of the same exception handling and response format. To make
use of the JSON API resp. Crnk exception handling in JAX-RS services, one can add the
<strong>JsonapiExceptionMapperBridge</strong> to the JAX-RS application. The constructor of <code>JsonapiExceptionMapperBridge</code>
takes <code>CrnkFeature</code> as parameter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_return_resources_with_jax_rs_services">2.2.3. Return resources with JAX-RS services</h4>
<div class="paragraph">
<p>Similar to <code>JsonapiExceptionMapperBridge</code> in the previous section, it is possible for JAX-RS services to return
resources in JSON API format. In order to properly serialize such responses, add
<strong>JsonApiResponseFilter</strong> to your JAX-RS application. The constructor of <code>JsonApiResponseFilter</code>
takes <code>CrnkFeature</code> as parameter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jax_rs_interoperability">2.2.4. JAX-RS interoperability</h4>
<div class="paragraph">
<p>Note that it is possible to implement repositories that host both JAX-RS and JSON-API methods to complement JSON
API repositories with non-resource based services. Have a look at the <a href="#client_jaxrs">Crnk Client chapter</a> for an example.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integration_with_servlet_api">2.3. Integration with Servlet API</h3>
<div class="paragraph">
<p>There are two ways of integrating crnk using Servlets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding an instance of <code>AbstractCrnkServlet</code></p>
</li>
<li>
<p>Adding an instance of <code>AbstractCrnkFilter</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_integrating_using_a_servlet">2.3.1. Integrating using a Servlet</h4>
<div class="paragraph">
<p>There is a <code>CrnkServlet</code> implementation allowing to integrate Crnk into a Servlet environment.
It can be configured with all the parameters outlined in the subsequent sections. Many times
application will desire to do more advanced customizations, in this case one can
extends <code>CrnkServlet</code> and get access to <code>CrnkBoot</code>. The code below shows a sample implementation:</p>
</div>
<div class="listingblock">
<div class="title">SampleCrnkServlet.java</div>
<div class="content">
<pre class="CodeRay highlight"><code>public class SampleCrnkServlet extends CrnkServlet {

	@Override
	protected void initCrnk(CrnkBoot boot) {
		// do your configuration here
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The newly created servlet must be added to the <code>web.xml</code> file or to another deployment descriptor.
The code below shows a sample <code>web.xml</code> file with a properly defined and configured servlet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  &lt;web-app&gt;
    &lt;servlet&gt;
      &lt;servlet-name&gt;SampleCrnkServlet&lt;/servlet-name&gt;
      &lt;servlet-class&gt;io.crnk.servlet.SampleCrnkServlet&lt;/servlet-class&gt;
      &lt;init-param&gt;
        &lt;param-name&gt;crnk.config.core.resource.package&lt;/param-name&gt;
        &lt;param-value&gt;io.crnk.servlet.resource&lt;/param-value&gt;
      &lt;/init-param&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;SampleCrnkServlet&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/api/v1/ *&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
  &lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may omit the <code>resourceSearchPath</code> depending on which discovery mechanism is in place (see below).</p>
</div>
</div>
<div class="sect3">
<h4 id="_integrating_using_a_filter">2.3.2. Integrating using a filter</h4>
<div class="paragraph">
<p>Integrating Crnk as a Servlet filter works in a very similar fashion as for servlets:</p>
</div>
<div class="listingblock">
<div class="title">SampleCrnkFilter.java</div>
<div class="content">
<pre class="CodeRay highlight"><code>public class SampleCrnkFilter extends CrnkFilter {

	@Override
	protected void initCrnk(CrnkBoot boot) {
		// do your configuration here
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The newly created filter must be added to <code>web.xml</code> file or other deployment descriptor.
A code below shows a sample <code>web.xml</code> file with properly defined and configured filter</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  &lt;web-app&gt;
    &lt;filter&gt;
      &lt;filter-name&gt;SampleCrnkFilter&lt;/filter-name&gt;
      &lt;filter-class&gt;io.crnk.servlet.SampleCrnkFilter&lt;/filter-class&gt;
      &lt;init-param&gt;
        &lt;param-name&gt;crnk.config.core.resource.package&lt;/param-name&gt;
        &lt;param-value&gt;io.crnk.servlet.resource&lt;/param-value&gt;
      &lt;/init-param&gt;
    &lt;/filter&gt;
  &lt;/web-app&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integration_with_spring">2.4. Integration with Spring</h3>
<div class="paragraph">
<p>Crnk provides a simple Spring Boot integration using the <code>@Configuration</code> annotated class <code>CrnkConfigV3</code>.
Using this class, the only thing needed to allow Crnk process requests is parameter configuration.
An example <code>application.properties</code> file is presented below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  crnk.domainName=http://localhost:8080
  crnk.pathPrefix=/api</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring integration uses crnk-servlet <code>AbstractCrnkFilter</code> to fetch the requests. Similar to CDI, repositories
and modules are picked up from the Spring ApplicationContext with  <code>SpringServiceDiscovery</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_discovery_with_cdi">2.5. Discovery with CDI</h3>
<div class="paragraph">
<p>To enable CDI support, add <code>io.crnk:crnk-cdi</code> to your classpath. Crnk will then pickup the
<code>CdiServiceDiscovery</code> implementation and use it to discover its modules and repositories. Modules, repositories,
etc. will then be picked up if they are registered as CDI beans.</p>
</div>
</div>
<div class="sect2">
<h3 id="_discovery_with_spring">2.6. Discovery with Spring</h3>
<div class="paragraph">
<p>The Spring integration comes with a <code>SpringServiceDiscovery</code> that makes use of the Spring <code>ApplicationContext</code>
to discover beans.</p>
</div>
</div>
<div class="sect2">
<h3 id="_discovery_without_a_dependency_injection_framework">2.7. Discovery without a dependency injection framework</h3>
<div class="paragraph">
<p>If no dependency injection framework is used, Crnk can also discover beans on its own. For this purpose,
the <code>org.reflections:reflections</code> library has to be added to the classpath and the
<code>CrnkProperties.RESOURCE_SEARCH_PACKAGE</code> be defined. In JAX-RS this may look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>@ApplicationPath("/")
	public class MyApplication extends Application {

		@Override
        public Set&lt;Object&gt; getSingletons() {
            CrnkFeature crnkFeature = new CrnkFeature();
            crnkFeature.getBoot().setServiceLocator(...);
            return Collections.singleton((Object)crnkFeature);
        }

		@Override
        public Map&lt;String, Object&gt; getProperties() {
            Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
            map.put(CrnkProperties.RESOURCE_SEARCH_PACKAGE, "com.myapplication.model")
            return map;
        }
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>JsonServiceLocator</code> service locator can be provided to control the instatiation of object. By default the default
constructor will be used. The <code>CrnkProperties.RESOURCE_SEARCH_PACKAGE</code> property is passed to define which package
should be searched for beans. Multiple packages can be passed by specifying a comma separated string
of packages i.e. com.company.service.dto,com.company.service.repository. It will pick up any public non-abstract
class that makes use of Crnk interfaces, like repositories, exception mappers and modules.</p>
</div>
</div>
<div class="sect2">
<h3 id="_no_discovery">2.8. No Discovery</h3>
<div class="paragraph">
<p>It is also possible to make use of no discovery mechanism at all. In this case it is still possible to add repositories
and other features through modules. Have a look at the various module related chapters.</p>
</div>
</div>
<div class="sect2">
<h3 id="_crnkboot">2.9. CrnkBoot</h3>
<div class="paragraph">
<p><code>CrnkBoot</code> is a class shared among all the different integrations that takes care of setting up and starting
Crnk. Every integration will provide access to it, which in turn allows for virtually any kind of customization.</p>
</div>
<div class="paragraph">
<p>Some possiblities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getObjectMapper</code> allows access to the used Jackson instance.</p>
</li>
<li>
<p><code>addModule</code> allows to add a module.</p>
</li>
<li>
<p><code>setServiceDiscovery</code> sets a custom service discovery mechanism.</p>
</li>
<li>
<p><code>setPropertiesProvider</code> allows to set how properties are resolved.</p>
</li>
<li>
<p><code>getQuerySpecDeserializer</code> and <code>setQuerySpecDeserializer</code> allows to reconfigure how parameters are parsed.
Note that in some areas JSON API only provides reocmmendations and Crnk follows those recommendations
by default. So depending on your use cases, you may want to configure or implement some aspects differently.</p>
</li>
<li>
<p><code>setMaxPageLimit</code> allows to set the maximum number of allowed resources that can be fetched with a request
by limiting pagination.</p>
</li>
<li>
<p><code>setDefaultPageLimit</code> allows to set a default page limit if none is specified by the request. <strong>Highly
recommended</strong> to be used as people frequently browse repositories on there own with a web browser and
fail to provide pagination. As a result, your entire database may get downloaded and may bring down
your servers depending on the datasize.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_parameters">2.10. Parameters</h3>
<div class="paragraph">
<p>Any of the integrations allows API access to customize Crnk. There are also a number of configuration flags
provided by <code>CrnkProperties</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>crnk.config.core.resource.domain</code>
Domain name as well as protocol and optionally port number used when building links objects in responses i.e. <a href="http://crnk.io" class="bare">http://crnk.io</a>.
The value must not end with <code>/</code>. If the property is omitted, then they are extracted from the incoming request, which should work
well for most use cases.</p>
</li>
<li>
<p><code>crnk.config.web.path.prefix</code>
Default prefix of a URL path used in two cases:</p>
<div class="ulist">
<ul>
<li>
<p>When building <code>links</code> objects in responses</p>
</li>
<li>
<p>When performing method matching
An example of a prefix <code>/api/v1</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resource">3. Resource</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A resource as defined by JSON API holds the actual data. The engine part of <code>crnk-core</code> is agnostic to how such resources are
actually
implemented (see the architecture and modules chapters). This chapter gives information of the most common way using
annotations provided by <code>crnk-core</code>.</p>
</div>
<div class="sect2">
<h3 id="_jsonapiresource">3.1. JsonApiResource</h3>
<div class="paragraph">
<p>It is the most important annotation which defines a resource. It requires type parameter to be defined that is used to form a URLs and type field in passed JSONs. According to JSON API standard, the name defined in type can be either plural or singular</p>
</div>
<div class="paragraph">
<p>The example below shows a sample class which contains a definition of a resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  @JsonApiResource(type = "tasks")
  public class Task {
    // fields, getters and setters
  }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jsonapiid">3.2. JsonApiId</h3>
<div class="paragraph">
<p>Defines a field which will be used as an identifier of a resource.
Each resource requires this annotation to be present on a field which type implements <code>Serializable</code> or is of primitive type.</p>
</div>
<div class="paragraph">
<p>The example below shows a sample class which contains a definition of a field which contains an identifier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  @JsonApiResource(type = "tasks")
  public class Task {
    @JsonApiId
    private Long id;

    // fields, getters and setters
  }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jsonapirelation">3.3. JsonApiRelation</h3>
<div class="paragraph">
<p>Indicates an association to either a single value or collection of resources. The type of such fields
must be a valid resource.</p>
</div>
<div class="paragraph">
<p>The example below shows a sample class which contains this kind of relationship.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  @JsonApiResource(type = "tasks")
  public class Task {

    // ID field

    @JsonApiRelation(lookUp=LookupIncludeBehavior.AUTOMATICALLY_WHEN_NULL,serialize=SerializeType.ONLY_ID)
    private Project project;

    // fields, getters and setters
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The optional <code>serialize</code> parameter specifies how the association should be serialized when making a request.
There are two things to consider. Whether related resources should be added to the <code>include</code> section of the
response document. And whether the id of related resources should be serialized along with the resource
in the corresponding <code>relationships.[name].data</code> section. Either <code>LAZY</code>, <code>ONLY_ID</code> or <code>EAGER</code> can be specified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>LAZY</code> only serializes the ID and does the inclusion if explicitly requested by the <code>include</code> URL parameter. This is the default.</p>
</li>
<li>
<p><code>ONLY_ID</code> always serializes the ID, but does only to an inclusion  if explicitly requested by the <code>include</code> URL parameter.</p>
</li>
<li>
<p><code>EAGER</code> always both serializes the ID and does an inclusion.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are two possibilities of how related resources are fetched. Either the requested repository directly
returns related resources with the returned resources. Or Crnk can take-over that
work by doing nested calls to the corresponding <code>RelationshipRepositoryV2</code> implementations. The behavior
is controlled by the optional <code>lookUp</code> parameter. There are three options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'NONE' makes the requested repository responsible for returning related resources. This is the default.</p>
</li>
<li>
<p>'AUTOMATICALLY_WHEN_NULL' will let Crnk lookup related resources if not already done by the requested repository.</p>
</li>
<li>
<p>'AUTOMATICALLY_ALWAYS' will force Crnk to always lookup related resource regardless whether it is already done by the requested repository.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_jsonapimetainformation">3.4. JsonApiMetaInformation</h3>
<div class="paragraph">
<p>Field or getter annotated with <code>JsonApiMetaInformation</code> are marked to carry a <code>MetaInformation</code> implementation.
See <a href="http://jsonapi.org/format/#document-meta" class="bare">http://jsonapi.org/format/#document-meta</a> for more information about meta data. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	@JsonApiResource(type = "projects")
	public class Project {

		...

		@JsonApiMetaInformation
		private ProjectMeta meta;

		public static class ProjectMeta implements MetaInformation {

			private String value;

			public String getValue() {
				return value;
			}

			public void setValue(String value) {
				this.value = value;
			}
		}
	}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jsonapilinksinformation">3.5. JsonApiLinksInformation</h3>
<div class="paragraph">
<p>Field or getter annotated with <code>JsonApiLinksInformation</code> are marked to carry a <code>LinksInformation</code> implementation.
See <a href="http://jsonapi.org/format/#document-links" class="bare">http://jsonapi.org/format/#document-links</a> for more information about linking. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	@JsonApiResource(type = "projects")
	public class Project {

		...

		@JsonApiLinksInformation
		private ProjectLinks links;

		public static class ProjectLinks implements MetaInformation {

			private String value;

			public String getValue() {
				return value;
			}

			public void setValue(String value) {
				this.value = value;
			}
		}
	}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_repositories">4. Repositories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The modelled resources must be complemented by a corresponding
repository implementation. This is achieved by implementing
one of those two repository interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ResourceRepositoryV2 for a resource</p>
</li>
<li>
<p>RelationshipRepositoryV2 resp. BulkRelationshipRepositoryV2 for resource relationships</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_resourcerepositoryv2">4.1. ResourceRepositoryV2</h3>
<div class="paragraph">
<p>Base repository which is used to operate on resources.
Each resource should have a corresponding repository implementation.
It consist of five basic methods which provide a CRUD for a resource and two parameters: the first is a type of a resource and the second is a type of the resource’s identifier.</p>
</div>
<div class="paragraph">
<p>The methods are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>findOne(ID id, QuerySpec querySpec)</code>
Search one resource with a given ID. If a resource cannot be found, a ResourceNotFoundException exception should be thrown.
It should return an entity with associated relationships.</p>
</li>
<li>
<p><code>findAll(QuerySpec querySpec)</code>
Search for all of the resources. An instance of QuerySpec can be used if necessary.
If no resources can be found an empty Iterable or null must be returned.
It should return entities with associated relationships.</p>
</li>
<li>
<p><code>findAll(Iterable&lt;ID&gt;ids, QuerySpec querySpec)</code>
Search for resources constrained by a list of identifiers. An instance of QuerySpec can be used if necessary.
If no resources can be found an empty Iterable or null must be returned.
It should return entities with associated relationships.</p>
</li>
<li>
<p><code>save(S entity)</code>
Saves a resource. It should not save relating relationships. A Returning resource must include assigned identifier created for the instance of resource.
This method should be able to both create a new resource and update existing one.</p>
</li>
<li>
<p><code>delete(ID id)</code>
Removes a resource identified by id parameter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The ResourceRepositoryBase is a base class that takes care of some boiler-plate, like implementing findOne with findAll. An
implementation can then look as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	public class ProjectRepository extends ResourceRepositoryBase&lt;Project, String&gt; {

		private Map&lt;Long, Project&gt; projects = new HashMap&lt;&gt;();

		public ProjectRepository() {
			super(Project.class);
			save(new Project(1L, "Project A"));
			save(new Project(2L, "Project B"));
			save(new Project(3L, "Project C"));
		}

		@Override
		public synchronized void delete(String id) {
			projects.remove(id);
		}

		@Override
		public synchronized &lt;S extends Project&gt; S save(S project) {
			projects.put(project.getId(), project);
			return project;
		}

		@Override
		public synchronized ResourceList&lt;Project&gt; findAll(QuerySpec querySpec) {
			return querySpec.apply(projects.values());
		}
	}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_relationshiprepositoryv2">4.2. RelationshipRepositoryV2</h3>
<div class="paragraph">
<p>Each relationship defined in Crnk (annotation @JsonApiToOne and @JsonApiToMany) must have a relationship repository defined.</p>
</div>
<div class="paragraph">
<p>Base unidirectional repository responsible for operations on relations.
All of the methods in this interface have fieldName field as their last parameter to solve the problem of many relationships between the same resources.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>setRelation(T source, D_ID targetId, String fieldName)</code>
Sets a resource defined by targetId to a field fieldName in an instance source. If no value is to be set, null value is passed.</p>
</li>
<li>
<p><code>setRelations(T source, Iterable&lt;D_ID&gt; targetIds, String fieldName)</code>
Sets resources defined by targetIds to a field fieldName in an instance source. This is a all-or-nothing operation, that is no partial relationship updates are passed. If no values are to be set, empty Iterable is passed.</p>
</li>
<li>
<p><code>addRelations(T source, Iterable&lt;D_ID&gt; targetIds, String fieldName)</code>
Adds relationships to a list of relationships.</p>
</li>
<li>
<p><code>removeRelations(T source, Iterable&lt;D_ID&gt; targetIds, String fieldName)</code>
Removes relationships from a list of relationships.</p>
</li>
<li>
<p><code>findOneTarget(T_ID sourceId, String fieldName, QuerySpec querySpec)</code>
Finds one field&#8217;s value defined by fieldName in a source defined by sourceId.</p>
</li>
<li>
<p><code>findManyTargets(T_ID sourceId, String fieldName, QuerySpec querySpec)</code>
Finds an Iterable of field&#8217;s values defined by fieldName in a source defined by sourceId .</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This interface must be implemented to let Crnk work correctly, some of the requests are processed using only this kind of repository.
As it can be seen above, there are two kinds of methods: for multiple and single relationships and it is possible to implement only one type of methods, e.g. singular methods.
Nevertheless, it should be avoided because of potential future problems when adding new fields of other sizes.</p>
</div>
<div class="paragraph">
<p>In many cases, relationship operations can be mapped back to resource repository operations. Making the need
for a custom relationship repository implementation redundant. A findManyTargets request might can be
served by filtering the target repository. Or a relationship can be set by invoking the save operation
on either the source or target resource repository (usually you want to save on the single-valued side).
The ResourceRepositoryBase is a base class that takes care of exactly this. A repository
implementation then looks as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	public class ProjectToTaskRepository extends RelationshipRepositoryBase&lt;Project, Long, Task, Long&gt; {

		public ScheduleToTaskRepository() {
			super(Project.class, Task.class);
		}
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this to work, relations must be set up bidirectionally with the <code>opposite</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	@JsonApiResource(type = "tasks")
	public class Task {

		@JsonApiToOne(opposite = "tasks")
		@JsonApiIncludeByDefault
		private Project project;

	    ...
	}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bulkrelationshiprepositoryv2">4.3. BulkRelationshipRepositoryV2</h3>
<div class="paragraph">
<p>BulkRelationshipRepositoryV2 extends RelationshipRepositoryV2 and provides an additional
<code>findTargets</code> method. It allows to fetch a relation for multiple resources at once.
It is recommended to make use of this implementation if a relationship is loaded frequently
(either by a eager declaration or trough the <code>include</code> parameter) and it is costly to
fetch that relation. RelationshipRepositoryBase provides a default implementation where
<code>findOneTarget</code> and <code>findManyTargets</code> forward calls to the bulk <code>findTargets</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resourcelist">4.4. ResourceList</h3>
<div class="paragraph">
<p>ResourceRepositoryV2 and RelationshipRepositoryV2 return lists of type ResourceList. The ResourceList can carry, next
to the actual resources, also meta and links information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getLinks()</code>
Gets the links information attached to this lists.</p>
</li>
<li>
<p><code>getMeta()</code>
Gets the meta information attached to this lists.</p>
</li>
<li>
<p><code>getLinks(Class&lt;L&gt; linksClass)</code>
Gets the links information of the given type attached to this lists. If the given type is not found, null is returned.</p>
</li>
<li>
<p><code>getMeta(Class&lt;M&gt; metaClass)</code>
Gets the meta information of the given type attached to this lists. If the given type is not found, null is returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a default implementation named DefaultResourceList. To gain type-safety, improved readability and crnk-client support,
application may provide a custom implementation extending ResourceListBase:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	class ScheduleList extends ResourceListBase&lt;Schedule, ScheduleListMeta, ScheduleListLinks&gt; {

	}

	class ScheduleListLinks implements LinksInformation {

		public String name = "value";

		...
	}

	class ScheduleListMeta implements MetaInformation {

		public String name = "value";

		...
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This implementation can then be added to a repository interface declaration
and used by both servers and clients:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	public interface ScheduleRepository extends ResourceRepositoryV2&lt;Schedule, Long&gt; {

		@Override
		public ScheduleList findAll(QuerySpec querySpec);

	}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_query_parameters_with_queryspec">4.5. Query parameters with QuerySpec</h3>
<div class="paragraph">
<p>Crnk passes JSON API query parameters to repositories trough a QuerySpec parameter. It holds
request parameters like sorting and filtering specified by JSON API. The subsequent
sections will provide a number of example.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Not everything is specified by JSON API. For some request parameters only recommendations
are provided as different applications are likely to be in need of different semantics and
implementations. For this reason the engine part in <code>crnk-core</code> makes use of <code>QueryAdapter</code> and allows implementations other than
QuerySpec (like the legacy <code>QueryParams</code>).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_filtering">4.5.1. Filtering</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The JSON API specification does not a mandate a specific filtering semantic. Instead
it provides a recommendation that comes by default with Crnk. Depending on the data store
in use, application may choose to extend or replace that default implementation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Resource filtering can be achieved by providing parameters which start with <code>filter</code>.
The format for filters: <code>filter[ResourceType][property|operator]([property|operator])* = "value"</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GET /tasks/?filter[name]=Super task</code></p>
</li>
<li>
<p><code>GET /tasks/?filter[name][EQ]=Super task</code></p>
</li>
<li>
<p><code>GET /tasks/?filter[tasks][name]=Super task</code></p>
</li>
<li>
<p><code>GET /tasks/?filter[tasks][name]=Super task&amp;filter[tasks][dueDate]=2015-10-01</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>QuerySpec uses the <code>EQ</code> operator if no operator was provided.</p>
</div>
<div class="paragraph">
<p>Operators are represented by the <code>FilterOperator</code> class. Crnk comes with a set of
default filters:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Descriptor</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EQ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">equals operator where values match exactly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEQ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not equals where values do not match.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIKE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">where the value matches the specified pattern. It is usually
 not case-sensitive and makes use of <code>%</code> as wildclard, but
 may different depending on the underlying implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lower than the specified value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lower than or equals the specified value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than the specified value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than or equals the specified value</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The application is free to implements its own <code>FilterOperator</code>. Next to the name
a <code>matches</code> method can be implemented to support in-memory filtering
with <code>QuerySpec.apply</code>. Otherwise, it is up to the repository implementation
to handle the various filter operators; usually by translating them
to datastore-native query expressions. Custom operators can be registered
with <code>DefaultQuerySpecDeserializer.addSupportedOperator(..)</code>. The default operator can be
overridden by setting <code>DefaultQuerySpecDeserializer.setDefaultOperator(&#8230;&#8203;)</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sorting">4.5.2. Sorting</h4>
<div class="paragraph">
<p>Sorting information for the resources can be achieved by providing <code>sort</code> parameter.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GET /tasks/?sort=name,-shortName</code></p>
</li>
<li>
<p><code>GET /tasks/?sort[projects]=name,-shortName&amp;include=projects</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_pagination">4.5.3. Pagination</h4>
<div class="paragraph">
<p>Pagination for the repositories can be achieved by providing <code>page</code> parameter.
The format for pagination: <code>page[offset|limit] = "value", where value is an integer</code></p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GET /tasks/?page[offset]=0&amp;page[limit]=10</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that JSON API specifies first, previous, next and last links (see <a href="http://jsonapi.org/format/#fetching-pagination" class="bare">http://jsonapi.org/format/#fetching-pagination</a>).
Crnk provides support to compute those pagination links. For this two work, a repository
has to return meta and links information implementing PagedMetaInformation resp. PagedLinksInformation.
With PagedMetaInformation the repository can let Crnk know about the total number of (potentially filtered)
resources. Crnk then fills in PagedLinksInformation with the corresponding links.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sparse_fieldsets">4.5.4. Sparse Fieldsets</h4>
<div class="paragraph">
<p>Information about fields to include in the response can be achieved by providing <code>fields</code> parameter.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GET /tasks/?fields=name</code></p>
</li>
<li>
<p><code>GET /tasks/?fields[projects]=name,description&amp;include=projects</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_inclusion_of_related_resources">4.5.5. Inclusion of Related Resources</h4>
<div class="paragraph">
<p>Information about relationships to include in the response can be achieved by providing <code>include</code> parameter.
The format for fields: <code>include[ResourceType] = "property(.property)*"</code></p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GET /tasks/?include[tasks]=project</code></p>
</li>
<li>
<p><code>GET /tasks/1/?include[tasks]=project</code></p>
</li>
<li>
<p><code>GET /tasks/?include[tasks]=author</code></p>
</li>
<li>
<p><code>GET /tasks/?include[tasks][]=author&amp;include[tasks][]=comments</code></p>
</li>
<li>
<p><code>GET /tasks/?include[projects]=task&amp;include[tasks]=comments</code></p>
</li>
<li>
<p><code>GET /tasks/?include[projects]=task&amp;include=comments</code> (QuerySpec example)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_api">4.5.6. API</h4>
<div class="paragraph">
<p>The QuerySpec API looks like (further setters available as well):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	public class QuerySpec {
		public &lt;T&gt; List&lt;T&gt; apply(Iterable&lt;T&gt; resources){...}

		public Long getLimit() {...}

		public long getOffset() {...}

		public List&lt;FilterSpec&gt; getFilters() {...}

		public List&lt;SortSpec&gt; getSort() {...}

		public List&lt;IncludeFieldSpec&gt; getIncludedFields() {...}

		public List&lt;IncludeRelationSpec&gt; getIncludedRelations() {...}

		public QuerySpec getQuerySpec(Class&lt;?&gt; resourceClass) {...}

		...
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that single QuerySpec holds the parameters for a single resource type and,
in more complex scenarios, request can lead to multiple QuerySpec instances
(namely when related resources are also filtered, sorted, etc). A repository
is invoked with the QuerySpec for the requested root type. If related resources are
included in the request, their QuerySpecs can be obtained by calling <code>QuerySpec.getRelatedSpec(Class)</code> on the root QuerySpec.</p>
</div>
<div class="paragraph">
<p><code>FilterSpec</code> holds a value of type object. Since URL parameters are passed as String,
they get converted to the proper types by the <code>DefaultQuerySpecDeserializer</code>. The
type is determined based on the type of the filtered attribute.</p>
</div>
<div class="paragraph">
<p>QuerySpec provides a method <code>apply</code> that allows in-memory sorting, filtering and paging
on any <code>java.util.Collection</code>. It is useful for testing and on smaller datasets to keep
the implementation of a repository as simple as possible. It returns a ResourceList
that carries a PagedMetaInformation that lets Crnk automatically compute pagination links.</p>
</div>
</div>
<div class="sect3">
<h4 id="_defaultqueryspecdeserializer">4.5.7. DefaultQuerySpecDeserializer</h4>
<div class="paragraph">
<p>Crnk make use of <code>DefaultQuerySpecDeserializer</code> to map URL parameters to a QuerySpec instance.
This instance is accessible from the various integrations, such as from the <code>CrnkFeature</code>. It
provides a number of customization options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>setDefaultLimit(Long)</code>
Sets the page limit if none is specified by the request.</p>
</li>
<li>
<p><code>setMaxPageLimit(Long)</code>
Sets the maximum page limit allowed to be requested.</p>
</li>
<li>
<p><code>setIgnoreUnknownAttributes(boolean)</code>
DefaultQuerySpecDeserializer validates all passed parameters against the domain model and fails
if one of the attributes is unknown. This flag allows to disable that check in case the should be necessary.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that appropriate page limits are vital to protect against denial-of-service attacks when working
with large data sets!</p>
</div>
<div class="paragraph">
<p><code>DefaultQuerySpecDeserializer</code> implements <code>QuerySpecDeserializer</code> and you may also provide your own
implementation to further customize its behavior. The various integrations like <code>CrnkFeature</code> will
allow to replace the implementation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_error_handling">4.6. Error Handling</h3>
<div class="paragraph">
<p>Processing errors in Crnk can be handled by throwing an exception and providing
a corresponding exception mapper which defines mapping to a proper JSON API error response.</p>
</div>
<div class="sect3">
<h4 id="_throwing_an_exception">4.6.1. Throwing an exception&#8230;&#8203;</h4>
<div class="paragraph">
<p>Here is an example of throwing an Exception in the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  if (somethingWentWrong()) {
    throw new SampleException("errorId", "Oops! Something went wrong.")
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sample exception is nothing more than a simple runtime exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  public class SampleException extends RuntimeException {

    private final String id;
    private final String title;

    public ExampleException(String id, String title) {
      this.id = id;
      this.title = title;
    }

    public String getId() {
      return id;
    }

    public String getTitle() {
      return title;
    }
  }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__and_mapping_it_to_json_api_response">4.6.2. &#8230;&#8203;and mapping it to JSON API response</h4>
<div class="paragraph">
<p>Class responsible for mapping the exception should:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>implement JsonApiExceptionMapper interface</p>
</li>
<li>
<p>available trough the used discovery mechanism or added trough a module.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sample exception mapper:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  public class SampleExceptionMapper implements JsonApiExceptionMapper&lt;SampleException&gt; {
    @Override
    public ErrorResponse toErrorResponse(SampleException exception) {
      return ErrorResponse.builder()
        .setStatus(HttpStatus.INTERNAL_SERVER_ERROR_500)
        .setSingleErrorData(ErrorData.builder()
          .setTitle(exception.getTitle())
          .setId(exception.getId())
          .build())
        .build();
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>An exception should be mapped to an ErrorResponse object.
It consists of an HTTP status and ErrorData (which is consistent with JSON API error structure).</p>
</div>
<div class="paragraph">
<p>Note that the exception mapper is reponsible for providing the logging of exceptions with the
appropriate log levels. Also have a look at the subsequent section about the validation module that takes
care of JSR-303 bean validation exception mapping.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_meta_information">4.7. Meta Information</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
With ResourceList and @JsonApiMetaInformation meta information can be returned directly. A MetaRepository implementation is no longer necessary.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is a special interface which can be added to resource repositories to provide meta information: <code>io.crnk.core.repository.MetaRepository</code>.
It contains a single method <code>MetaInformation getMetaInformation(Iterable&lt;T&gt; resources)</code> which return meta information object that implements the marker <code>interface io.crnk.response.MetaInformation</code>.</p>
</div>
<div class="paragraph">
<p>If you want to add meta information along with the responses, all repositories (those that implement <code>ResourceRepository</code> and <code>RelationshipRepository</code>) must implement <code>MetaRepository</code>.</p>
</div>
<div class="paragraph">
<p>When using annotated versions of repositories, a method that returns a <code>MetaInformation</code> object should be annotated with <code>JsonApiMeta</code> and the first parameter of the method must be a list of resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="_links_information">4.8. Links Information</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
With ResourceList and @JsonApiLinksInformation links information can be returned directly. A LinksRepository implementation is usually not necessary.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is a special interface which can be added to resource repositories to provide links information: <code>io.crnk.core.repository.LinksRepository</code>.
It contains a single method <code>LinksInformation getLinksInformation(Iterable&lt;T&gt; resources)</code> which return links information object that implements the marker <code>interface io.crnk.response.LinksInformation</code>.</p>
</div>
<div class="paragraph">
<p>If you want to add meta information along with the responses, all repositories (those that implement <code>ResourceRepository</code> and <code>RelationshipRepository</code>), must implement <code>LinksRepository</code>.</p>
</div>
<div class="paragraph">
<p>When using annotated versions of repositories, a method that returns a <code>LinksInformation</code> object should be annotated with <code>JsonApiLinks</code> and the first parameter of the method has to be a list of resources.
:basedir: ../../../..
:clientdir: {basedir}/crnk-client</p>
</div>
<div class="paragraph">
<p><a id="client"></a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_client">5. Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is a client implementation for Java and Android projects to allow
communicating with JSON-API compliant servers. Two http client libraries are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OkHttp <a href="http://square.github.io/okhttp" class="bare">http://square.github.io/okhttp</a></code>
Library has been used to allow usage in both Android and server applications and services.</p>
</li>
<li>
<p><code>Apache Http Client <a href="https://hc.apache.org/httpcomponents-client-ga/index.html" class="bare">https://hc.apache.org/httpcomponents-client-ga/index.html</a></code>
Library widely used in the Java community.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Add one of those library to the classpath and Crnk will pick it up automatically.</p>
</div>
<div class="paragraph">
<p>To start using the client just create an instance of <code>CrnkClient</code> and pass the service
URL as parameter.</p>
</div>
<div class="sect2">
<h3 id="_usage">5.1. Usage</h3>
<div class="paragraph">
<p>The client has three main methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CrnkClient#getRepositoryForInterface(Class)</code> to obtain a resource repository stub from an existing repository interface.</p>
</li>
<li>
<p><code>CrnkClient#getRepositoryForType(Class)</code> to obtain a generic resource repository stub from the provided resource type.</p>
</li>
<li>
<p><code>CrnkClient#getRepositoryForType(Class, Class)</code> to obtain a generic relationship repository stub from the provided source and target resource types.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The interface of the repositories is as same as defined in `Repositories`_ section.</p>
</div>
<div class="paragraph">
<p>An example of the usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  CrnkClient client = new CrnkClient("http://localhost:8080/api");
  ResourceRepositoryV2&lt;Task, Long&gt; taskRepo = client.getRepositoryForType(Task.class);
  List&lt;Task&gt; tasks = taskRepo.findAll(new QuerySpec(Task.class));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Have a look at, for example, the QuerySpecClientTest to see more examples of how it is used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_type_safety">5.2. Type-Safety</h3>
<div class="paragraph">
<p>It is possible to work with <code>CrnkClient</code> in a fully type-safe manner.</p>
</div>
<div class="paragraph">
<p>In a first step an interface for a repository is defined:</p>
</div>
<div class="listingblock">
<div class="title">ScheduleRepository.java</div>
<div class="content">
<pre class="CodeRay highlight"><code>public interface ScheduleRepository extends ResourceRepositoryV2&lt;Schedule, Long&gt; {
	@Override
	ScheduleList findAll(QuerySpec querySpec);

	class ScheduleList extends ResourceListBase&lt;Schedule, ScheduleListMeta, ScheduleListLinks&gt; {

	}

	class ScheduleListLinks extends DefaultPagedLinksInformation implements LinksInformation {

		public String name = "value";
	}

	class ScheduleListMeta implements MetaInformation {

		public String name = "value";

	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then it can be used like:</p>
</div>
<div class="listingblock">
<div class="title">QuerySpecClientTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code>		ScheduleRepository scheduleRepository = client.getResourceRepository(ScheduleRepository.class);

		Schedule schedule = new Schedule();
		schedule.setId(13L);
		schedule.setName("mySchedule");
		scheduleRepository.create(schedule);

		QuerySpec querySpec = new QuerySpec(Schedule.class);
		ScheduleList list = scheduleRepository.findAll(querySpec);
		Assert.assertEquals(1, list.size());
		ScheduleListMeta meta = list.getMeta();
		ScheduleListLinks links = list.getLinks();
		Assert.assertNotNull(meta);
		Assert.assertNotNull(links);</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="client_jaxrs"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_jax_rs_interoperability_2">5.3. JAX-RS interoperability</h3>
<div class="paragraph">
<p>The interface stubs from the previous section can also be used to make calls to JAX-RS. For example, the
<code>ScheduleRepository</code> can be complemented with a JAX-RS annotation:</p>
</div>
<div class="listingblock">
<div class="title">ScheduleRepository.java</div>
<div class="content">
<pre class="CodeRay highlight"><code>@Path("schedules")</code></pre>
</div>
</div>
<div class="paragraph">
<p>and further JAX-RS services can be added:</p>
</div>
<div class="listingblock">
<div class="title">ScheduleRepository.java</div>
<div class="content">
<pre class="CodeRay highlight"><code>	@GET
	@Path("repositoryAction")
	String repositoryAction(@QueryParam(value = "msg") String msg);

	@GET
	@Path("repositoryActionWithResourceResult")
	Schedule repositoryActionWithResourceResult(@QueryParam(value = "msg") String msg);

	@GET
	@Path("repositoryActionWithException")
	Schedule repositoryActionWithException(@QueryParam(value = "msg") String msg);

	@GET
	@Path("{id}/resourceAction")
	String resourceAction(@PathParam("id") long id, @QueryParam(value = "msg") String msg);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make this work a dependency to <code>org.glassfish.jersey.ext:jersey-proxy-client</code> must be added and <code>JerseyActionStubFactory</code>
registered with <code>CrnkClient</code>:</p>
</div>
<div class="listingblock">
<div class="title">AbstractClientTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code>		client.setActionStubFactory(JerseyActionStubFactory.newInstance());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then a client can make use the Crnk stubs and it will transparently switch between JSON-API and JAX-RS calls:</p>
</div>
<div class="listingblock">
<div class="title">JsonApiActionResponseTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code>		String result = scheduleRepository.repositoryAction("hello");
		Assert.assertEquals("repository action: hello", result);</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Due to limited configurability of the Jersey Proxies it is currently not possible to reuse the same HTTP connections
for both types of calls. We attempt to address that in the future. Be aware of this when you, for example, add further
request headers (like security), as it has to be done in two places (unfortunately).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_http_customization">5.4. HTTP customization</h3>
<div class="paragraph">
<p>It is possible to hook into the HTTP implementation used by Crnk (OkHttp or Apache).
Make use of <code>CrnkClient#getHttpAdapter()</code> and cast it to either
<code>HttpClientAdapter</code> or <code>OkHttpAdapter</code>. Both implementations provide a
<code>addListener</code> method, which in turn gives access to the native builder used to construct
the respective HTTP client implementation. This allows to cover various use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add custom request headers (security, tracing, etc.)</p>
</li>
<li>
<p>collect statistics</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may have a look at <code>crnk-brave</code> for an advanced example.
:basedir: ../../../..</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_modules">6. Modules</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_jpa_module">6.1. JPA Module</h3>
<div class="paragraph">
<p>The JPA module allows to automatically expose JPA entities as JSON API repositories. No implementation
or Crnk-specific annotations are necessary.</p>
</div>
<div class="paragraph">
<p>The feature set includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>expose JPA entities to JSON API repositories</p>
</li>
<li>
<p>expose JPA relations as JSON API repositories</p>
</li>
<li>
<p>decide which entities to expose as endpoints</p>
</li>
<li>
<p>sorting, filtering, paging, inclusion of related resources.</p>
</li>
<li>
<p>all default operators of crnk are supported: <code>EQ</code>, <code>NEQ</code>, <code>LIKE</code>, <code>LT</code>, <code>LE</code>, <code>GT</code>, <code>GE</code>.</p>
</li>
<li>
<p>filter, sort and include parameters can make use of the dot notation to
join to related entities. For example, <code>sort=-project.name,project.id</code>,
 <code>filter[project.name][NEQ]=someValue</code> or <code>include=project.tasks</code>.</p>
</li>
<li>
<p>support for entity inheritance by allowing sorting, filtering and inclusions
to refer to attributes on subtypes.</p>
</li>
<li>
<p>DTO mapping support to map entities to DTOs before sending them to clients.</p>
</li>
<li>
<p>JPA Criteria API and QueryDSL support to issue queries.</p>
</li>
<li>
<p>filter API to intercept and modify issued queries.</p>
</li>
<li>
<p>support for computed attributes behaving like regular, persisted attributes.</p>
</li>
<li>
<p>automatic transaction handling spanning requests and doing a rollback in case of an exception.</p>
</li>
<li>
<p><code>OptimisticLockExceptionMapper</code> mapped to JSON API errors with
<code>409</code> status code.</p>
</li>
<li>
<p><code>PersistenceException</code> and <code>RollbackException</code> are unwrapped
to the usually more interesting exceptions like
<code>ValidationException</code> and then translated to JSON API errors.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Have a look at the Spring Boot example application which makes use of the JPA module, DTO mapping
and computed attributes.</p>
</div>
<div class="paragraph">
<p>Not yet supported are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>sparse field sets.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_jpa_setup">6.1.1. JPA Setup</h4>
<div class="paragraph">
<p>To use the module, add a dependency to <code>io.crnk:crnk-jpa</code> and register the <code>JpaModule</code>
to Crnk. For example in the case of JAX-RS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	TransactionRunner transactionRunner = ...;
	JpaModule jpaModule = JpaModule.newServerModule(entityManagerFactory, entityManager, transactionRunner);
	jpaModule.setRepositoryFactory(new ValidatedJpaRepositoryFactory());

	CrnkFeature feature = new CrnkFeature(...);
	feature.addModule(jpaModule);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JPA modules by default looks up the entityManagerFactory and obtains a list
of registered JPA entities. For each entity a instance of <code>JpaEntityRepository</code>
is registered to Crnk using the module API. Accordingly, every relation
is registered as <code>JpaRelationshipRepository</code>. <code>JpaModule.setRepositoryFactory</code>
allows to provide a factory to change or customized the used repositories.
To manually select the entities exposed to Crnk use <code>JpaModule.addEntityClass(&#8230;&#8203;)</code>
and <code>JpaModule.removeEntityClass(&#8230;&#8203;)</code>. If no <code>entityManagerFactory</code> is provided
to newServerModule, then the registration of entities is omitted and can be done
manually.</p>
</div>
<div class="paragraph">
<p>The transactionRunner needs to be implemented by the application to hook into the
transaction processing of the used environment (Spring, JEE, etc.). This might be
as simple as a Spring bean implementing <code>TransactionRunner</code> and adding a
<code>@Transactional</code> annotation. The JPA module makes sure that every call to a
repository happens within such a transaction boundary.</p>
</div>
<div class="paragraph">
<p>To setup a Crnk client with the JPA module use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	client = new CrnkClient(getBaseUri().toString());

	JpaModule module = JpaModule.newClientModule();
	setupModule(module, false);
	client.addModule(module);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Have a look at <a href="https://github.com/crnk-project/crnk-framework/blob/develop/crnk-jpa/src/test/java/io/crnk/jpa/JpaQuerySpecEndToEndTest.java" class="bare">https://github.com/crnk-project/crnk-framework/blob/develop/crnk-jpa/src/test/java/io/crnk/jpa/JpaQuerySpecEndToEndTest.java</a> within the <code>crnk-jpa</code>
test cases to see how everything is used together with <code>crnk-client</code>.
The JPA modules further has a number of more advanced customization options that
are discussed in the subsequent sections.</p>
</div>
</div>
<div class="sect3">
<h4 id="_criteria_api_and_querydsl">6.1.2. Criteria API and QueryDSL</h4>
<div class="paragraph">
<p>The JPA module can work with two different query APIs, the default Criteria API
and QueryDSL. <code>JpaModule.setQueryFactory</code> allows
to choose between those two implementation. There is the <code>JpaCriteriaQueryFactory</code>
and the <code>QuerydslQueryFactory</code>. By default the Criteria API is used.
QueryDSL sits on top of JPQL and has to advantage of being easier to use.</p>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_jpa_repository">6.1.3. Customizing the JPA repository</h4>
<div class="paragraph">
<p>The setup page outlined the <code>JpaRepositoryFactory</code> that can be used to hook a custom JPA repository
implementations into the JPA module. The JPA module further provides a more
lightweight filter API to perform various changes to JPA repository requests:</p>
</div>
<div class="paragraph">
<p><code>JpaModule.addFilter(new MyRepositoryFilter())</code></p>
</div>
<div class="paragraph">
<p>A filter looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	public class MyRepositoryFilter extends JpaRepositoryFilterBase {

		boolean accept(Class&lt;?&gt; resourceType){...}

		&lt;T, I extends Serializable&gt; JpaEntityRepository&lt;T, I&gt; filterCreation(JpaEntityRepository&lt;T, I&gt; repository){...}

		QuerySpec filterQuerySpec(Object repository, QuerySpec querySpec){...}

		...
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The various filter methods allow a wide variety of customizations or also to replace the passed object in question.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dto_mapping">6.1.4. DTO Mapping</h4>
<div class="paragraph">
<p>Mapping to DTO objects is supported with <code>JpaModule.registerMappedEntityClass(&#8230;&#8203;)</code>.
A mapper then can be provided that translates the Entity to a DTO class.
Such a mapper might be implemented manually or generated (mostly) automatically
with tools like MapStruct. If two mapped entities are registered, there
respective mapped relationships will be automatically registered as well.</p>
</div>
<div class="paragraph">
<p>The mechanism is not limited to simple mappings, but can also introduce computed
attributes like in the example depicted here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	JpaModule module = JpaModule.newServerModule(emFactory, em, transactionRunner);
				module.setQueryFactory(QuerydslQueryFactory.newInstance());
	QuerydslExpressionFactory&lt;QTestEntity&gt; basicComputedValueFactory = new QuerydslExpressionFactory&lt;QTestEntity&gt;() {

		@Override
		public Expression&lt;String&gt; getExpression(QTestEntity parent, JPAQuery&lt;?&gt; jpaQuery) {
			return parent.stringValue.upper();
		}
	};

	QuerydslQueryFactory queryFactory = (QuerydslQueryFactory) module.getQueryFactory();
	queryFactory.registerComputedAttribute(TestEntity.class, TestDTO.ATTR_COMPUTED_UPPER_STRING_VALUE,
		 String.class, basicComputedValueFactory);
	module.addMappedEntityClass(TestEntity.class, TestDTO.class, new TestDTOMapper(entityManager));</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>	public class TestDTOMapper implements JpaMapper&lt;TestEntity, TestDTO&gt; {

		@Override
		public TestDTO map(Tuple tuple) {
			TestDTO dto = new TestDTO();
			TestEntity entity = tuple.get(0, TestEntity.class);
			dto.setId(entity.getId());
			dto.setStringValue(entity.getStringValue());
			dto.setComputedUpperStringValue(tuple.get("computedUpperStringValue", String.class));
			...
			return dto;
		}

		...

	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some of the regular entity attributes are mapped to the DTO. But there is also a
<code>computedUpperStringValue</code> attribute that is computed with an expression.
The expression can be written with the Criteria API or QueryDSL depending
on which query backend is in use.</p>
</div>
<div class="paragraph">
<p>Computed attributes are indistinguishable from regular, persisted entity attributes.
They can be used for selection, sorting and filtering. Both <code>JpaCriteriaQueryFactory</code>
and <code>QuerydslQueryFactory</code> provide a <code>registerComputedAttribute</code> method to
register an expression factory to create such computed attributes. The registration requires
the target entity and a name. To make the computed attribute available
to consumers, the mapper class has access to it trough the provided
tuple class. Have a look at <a href="https://github.com/crnk-project/crnk-framework/blob/develop/crnk-jpa/src/test/java/io/crnk/jpa/mapping/DtoMappingTest.java" class="bare">https://github.com/crnk-project/crnk-framework/blob/develop/crnk-jpa/src/test/java/io/crnk/jpa/mapping/DtoMappingTest.java</a> to see everything in use.</p>
</div>
<div class="paragraph">
<p>There is currently not yet any support for renaming of attribute. If attributes
are renamed on DTOs, the incoming QuerySpec has to be modified accordingly to
match again the entity attribute naming.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jsr_303_validation_module">6.2. JSR 303 Validation Module</h3>
<div class="paragraph">
<p>A <code>ValidationModule</code> provided by <code>io.crnk:crnk-validation</code> implements
exception mappers for <code>javax.validation.ValidationException</code> and <code>javax.validation.ConstraintViolationException</code>.
Among others, it properly translates 'javax.validation.ConstraintViolation' instances to JSON API errors.
A JSON API error can, among others, contain a source pointer. This source pointer allows a clients/UI to
display the validation errors next to the corresponding input fields.</p>
</div>
<div class="paragraph">
<p>A translated exception can look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>{
	"errors": [
		{
			"status": "422",
			"code": "javax.validation.constraints.NotNull",
			"title": "may not be null",
			"source": {
				"pointer": "data/attributes/name"
			},
			"meta": {
				"resourceId": "1",
				"type": "ConstraintViolation",
				"messageTemplate": "{javax.validation.constraints.NotNull.message}",
				"resourceType": "projects"
			}
		}
	]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the <code>422</code> status code used for such errors.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tracing_with_zipkin_brave">6.3. Tracing with Zipkin/Brave</h3>
<div class="paragraph">
<p>A <code>BraveModule</code> provided by <code>io.crnk:crnk-brave</code> provides integration into
Zipkin/Brave to implement tracing for your repositories.  The module is applicable to
both a Crnk client or server.</p>
</div>
<div class="paragraph">
<p>The Crnk client can make use of either HttpClient or OkHttp to issue HTTP requests.
Accordingly, a matching brave integration must be added to the classpath:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.zipkin.brave:brave-okhttp</code></p>
</li>
<li>
<p><code>io.zipkin.brave:brave-apache-http-interceptors</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>BraveModule</code> then takes care of the integration and will create a client span
for each request.</p>
</div>
<div class="paragraph">
<p>On the server-side, <code>BraveModule</code> creates a local span for each accessed repository.
Every request triggers one or more repository accesses (depending on whether
relations are included). Note however that <code>BraveModule</code> does not setup tracing
for incoming requests. That is the purpose of the JAX-RS/servlet integration of Brave.</p>
</div>
<div class="paragraph">
<p>Have a look at the Spring boot example application to see the <code>BraveModule</code> in use
together with a log reporter writing the output to console.</p>
</div>
</div>
<div class="sect2">
<h3 id="_security_module">6.4. Security Module</h3>
<div class="paragraph">
<p>This is an incurbation module that intercepts all repository requests and performs Role-based access
control. Have a look at the <code>SecurityModule</code> and the related <code>SecurityConfig</code> class.
A setup can looks as follows:</p>
</div>
<div class="listingblock">
<div class="title">SecurityModuleIntTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code>			Builder builder = SecurityConfig.builder();
			builder.permitRole("allRole", ResourcePermission.ALL);
			builder.permitRole("getRole", ResourcePermission.GET);
			builder.permitRole("patchRole", ResourcePermission.PATCH);
			builder.permitRole("postRole", ResourcePermission.POST);
			builder.permitRole("deleteRole", ResourcePermission.DELETE);
			builder.permitRole("taskRole", Task.class, ResourcePermission.ALL);
			builder.permitRole("taskReadRole", Task.class, ResourcePermission.GET);
			builder.permitRole("projectRole", Project.class, ResourcePermission.ALL);
			builder.permitAll(ResourcePermission.GET);
			builder.permitAll(Project.class, ResourcePermission.POST);
			module = SecurityModule.newServerModule(builder.build());

			CrnkFeature feature = new CrnkFeature();
			feature.addModule(module);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The security module further properly serializes javax.security
authorization and authentication exceptions. As such it is also recommended to be
used by CrnkClient.</p>
</div>
<div class="paragraph">
<p>Planned future extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>secure <code>QuerySpec</code> parameters to avoid illegal access to related entities.</p>
</li>
<li>
<p>remove unauthorized relationship links</p>
</li>
<li>
<p>show only authorized repository in <code>HomeModule</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_meta_module">6.5. Meta Module</h3>
<div class="paragraph">
<p>This is a module that exposes the internal workings of Crnk as JSON API repositories.
It lets you browse the set of available resources, their types, their attributes, etc. For example,
Crnk UI make use of the meta module to implement auto-completing of input fields.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There is currently no JSON API standard for meta data. There are more
general formats like Swagger and ALPS. At some point those might be supported as
well (probably rather the later than the former). One
can view them to be complementary to the <code>MetaModule</code> as the later
is exactly tailored towards JSON API, such as the accessability as regular
JSON API (meta) repository and data structures matching the standard. Most likely,
any future standard implementation will built up on the information from the
<code>MetaModule</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A setup can look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>		MetaModule metaModule = MetaModule.create();
		metaModule.addMetaProvider(new ResourceMetaProvider());</code></pre>
</div>
</div>
<div class="paragraph">
<p>To learn more about the set of available resources, have a look at the <code>MetaElement</code> class and all its subclasses. Some of the
most important classes are:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 70%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/meta/element</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MetaElement</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base class implemented by any meta element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/meta/type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MetaType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base class implemented by any meta type element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/meta/primitiveType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MetaPrimitiveType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents primitive types like Strings and Integers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/meta/arrayType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MetaArrayType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an array type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/meta/listType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MetaListType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an list type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/meta/setType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MetaSetType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an set type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/meta/mapType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MetaMapType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an map type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/meta/dataObject</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MetaDataObject</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base type for any object holding data, like
																			 JPA entities or JSON API resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/meta/attribute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MetaAttribute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an attribute of a <code>MetaDataObject</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/meta/resource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MetaResource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON API resource representation extending <code>MetaDataObject</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/meta/resourceRepository</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MetaResourceRepository</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON API repository representation holding resources.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <code>MetaResource</code> looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>{
    "id" : "io.crnk.example.springboot.domain.model.Project",
    "type" : "meta/resource",
    "attributes" : {
      "name" : "Project",
      "resourceType" : "projects"
    },
    "relationships" : {
      "parent" : {
        ...
      },
      "interfaces" : {
        ...
      },
      "declaredKeys" : {
        ...
      },
      "children" : {
        ...
      },
      "declaredAttributes" : {
        ...
      },
      "subTypes" : {
        ...
      },
      "attributes" : {
        ...
      },
      "superType" : {
        ...
      },
      "elementType" : {
        ...
      },
      "primaryKey" : {
        ...
      }
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>MetaAttribute</code> looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>{
    "id" : "io.crnk.example.springboot.domain.model.Project.name",
    "type" : "meta/resourceField",
    "attributes" : {
      "filterable" : true,
      "nullable" : true,
      "lazy" : false,
      "association" : false,
      "primaryKeyAttribute" : false,
      "sortable" : true,
      "version" : false,
      "insertable" : true,
      "meta" : false,
      "name" : "name",
      "updatable" : true,
      "links" : false,
      "derived" : false,
      "lob" : false,
      "cascaded" : false
    },
    "relationships" : {
      "parent" : {
        ...
      },
      "children" : {
        ...
      },
      "oppositeAttribute" : {
        ...
      },
      "type" : {
        ...
      }
    }
  }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_home_module">6.6. Home Module</h3>
<div class="paragraph">
<p>The <code>HomeModule</code> provides an implementation for <a href="https://tools.ietf.org/html/draft-nottingham-json-home-06">JSON Home</a>. It allows
you to obtain a list of available repositories when accessing the parent page of your repositories (typically <code>/api</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>		HomeModule metaModule = HomeModule.create();
		...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The module is currently in an incubator stage. In the Spring Boot example
applications it looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>{
  "resources" : {
    "tag:schedule" : {
      "href" : "/schedule/"
    },
    "tag:tasks" : {
      "href" : "/tasks/"
    },
    "tag:scheduleDto" : {
      "href" : "/scheduleDto/"
    },
    "tag:meta/collectionType" : {
      "href" : "/meta/collectionType/"
    },
    "tag:projects" : {
      "href" : "/projects/"
    },
     "tag:meta/resource" : {
	  "href" : "/meta/resource/"
	},
	"tag:meta/attribute" : {
	  "href" : "/meta/attribute/"
	},
	...
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operations_module">6.7. Operations Module</h3>
<div class="paragraph">
<p>By its nature RESTful applications are limited to the insertion, update and deletion of single resources. As such, developers
have to design resources accordingly while having to consider aspects like transaction handling and atomicity. It is not
uncommon to combine multiple data objects on the server-side and expose it as single resource to clients. It is a simple
approach, but can also mean quite a substantial overhead when having to implement potentially redudant repositories.
Furthermore, things like validation handling, relationships and supporting complex object graphs can get tricky when a single
resource starts holding complex object graphs again.</p>
</div>
<div class="paragraph">
<p>For all the before mentioned reason support for <a href="http://jsonpatch.com/">jsonpatch.com</a> is provided. It allows to send multiple
insertions, updates and deletions with a single request and provides the results for each such executed operation.
Note that numerous attempts and discussions have taken place and are still ongoing to establish a common JSON API standard,
but that does not seem to make much progress. With  <a href="http://jsonpatch.com/">jsonpatch.com</a> there is already an estabilished
standard that fits well for many use cases.</p>
</div>
<div class="paragraph">
<p>The implementation is provided as <code>OperationsModule</code> and the setup looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>		OperationsModule operationsModule = OperationsModule.create();
		...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Further filters can be applied to intercept incoming requests. Typically applications will make use of that to start a new
transaction spanning all requests. This looks as follows:</p>
</div>
<div class="listingblock">
<div class="title">AbstractOperationsTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code>			operationsModule.addFilter(new TransactionOperationFilter());</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is further an operations client implementation that works along the regular JSON API client implementation:</p>
</div>
<div class="listingblock">
<div class="title">OperationsPostTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code>		OperationsClient operationsClient = new OperationsClient(client);
		OperationsCall call = operationsClient.createCall();
		call.add(HttpMethod.POST, movie);
		call.add(HttpMethod.POST, person1);
		call.add(HttpMethod.POST, person2);
		call.execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The current limitations of the implementation are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>So far does not support bulk <code>GET</code> operations.</p>
</li>
<li>
<p>Does so far not support bulk update of relationships.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With support for <code>POST</code>, <code>PATCH</code> and <code>DELETE</code> operations the most important building blocks should be in place.
The limitations are expected to be addressed at some point as well, contributions welcomed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ui_module">6.8. UI Module</h3>
<div class="paragraph">
<p>The UI module makes <code>crnk-ui</code> accessible trough the module system. It allows to browse and edit all the repositories
and resources. The setup looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>		UIModule operationsModule = UIModule.create(new UIModuleConfig());
		...</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the user interface is accessible from the <code>/browse/</code> directory next to all the repositories.
Have a look at the Spring Boot example application to see a working example.</p>
</div>
<div class="paragraph">
<p>This module is currently in incubation. Please provide feedback.</p>
</div>
<div class="paragraph">
<p>An example from the Spring Boot example application looks like:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/crnk_ui.png" alt="crnk ui"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_development">7. Module Development</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Crnk has a module API that allows to extend the core functionality by third-party contributions.
The mentioned JPA module in the next section is an example for that. The API is similar in spirit
to the one of the <code><a href="https://github.com/FasterXML/jackson" class="bare">https://github.com/FasterXML/jackson</a></code>. The main interface is <code>Module</code> with
a default implementation provided by <code>SimpleModule</code>. A module has access to a <code>ModuleContext</code>
that allows to register all kinds of extensions like new <code>ResourceInformationBuilder</code>,
<code>ResourceLookup</code>, <code>Filter</code>, <code>ExceptionMapper</code> and Jackson modules. It also gives access to the
<code>ResourceRegistry</code> holding information about all the repositories registered to crnk.
The <code>JpaModule</code> in <code>crnk-jpa</code> provides a good, more advanced example of using the
module API.</p>
</div>
<div class="sect2">
<h3 id="_request_filtering">7.1. Request Filtering</h3>
<div class="paragraph">
<p>Crnk provides three different, complementing mechanisms to hook into the request processing.</p>
</div>
<div class="paragraph">
<p>The <code>DocumentFilter</code> interface allows to intercept incoming requests and do
any kind of validation, changes, monitoring, transaction handling, etc. <code>DocumentFilter</code> can be
hooked into Crnk by setting up a module and registering the filter to the
<code>ModuleContext</code>. Not that for every request, this interface is called exactly once.</p>
</div>
<div class="paragraph">
<p>A request may span multiple repository accesses. To intercept the actual repository requests,
implement the <code>RepositoryFilter</code> interface. <code>RepositoryFilter</code> has a number of methods
that allow two intercept the repository request at different stages. Like <code>Filter</code> it can be
hooked into Crnk by setting up a module and registering the filter to the
<code>ModuleContext</code>.</p>
</div>
<div class="paragraph">
<p>Similar to <code>RepositoryFilter</code> it is possible to decorate a repository with another repository
implementing the same Crnk repository interfaces. The decorated repository instead of
the actual repository will get called and it is up to the decorated repository of how to proceed
with the request, usually by calling the actual repository. <code>RepositoryDecoratorFactory</code>
can be registered with <code>ModuleContext.addRepositoryDecoratorFactory</code>. The factory gets
notified about every repository registration and is then free do decorate it or not.</p>
</div>
</div>
<div class="sect2">
<h3 id="_integrate_third_party_data_stores">7.2. Integrate third-party data stores</h3>
<div class="paragraph">
<p>The core of Crnk is quite flexible when it comes to implementing repositories. As such, it is
not mandatory to make use of the Crnk annotations and conventions. Instead, it is also
(likely) possible to integrate an existing data store setup like JPA, JDBC, ElasticSearch, etc.
into Crnk. For this purpose a module can provide custom implementations of
<code>ResourceInformationBuilder</code> and <code>RepositoryInformationBuilder</code> trough
<code>ModuleContext.addResourceInformationBuilder</code> and <code>ModuleContext.addRepositoryInformationBuilder</code>.
For example, the JpaModule of  <code>crnk-jpa</code> makes use of that to read JPA instead of Crnk annotations.
Such a module can then register additional (usually dynamic) repositories with
<code>ModuleContext.addRepository</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implement_a_custom_discovery_mechanism">7.3. Implement a custom discovery mechanism</h3>
<div class="paragraph">
<p>Crnk comes with out-of-the-box support for Spring and CDI. Both of them implement
<code>ServiceDiscovery</code>. You may provide your own implementation which can be hooked into the
various Crnk integrations, like the CrnkFeature. Modules have access to that
<code>ServiceDiscovery</code> trough the <code>ModuleContext</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_let_a_module_hook_into_the_crnk_http_client_implementation">7.4. Let a module hook into the Crnk HTTP client implementation</h3>
<div class="paragraph">
<p>Modules for the Crnk client can additionally implement <code>HttpAdapterAware</code>. It gives
the module access to the underlying HTTP client implementation and allows abitrary
customizations of it. Have a look at the Crnk client documentation for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implement_a_custom_integration">7.5. Implement a custom integration</h3>
<div class="paragraph">
<p>Adding a new integration has become quite simple in recent times.
Have a look at <code>crnk-servlet</code> and <code>crnk-rs</code>. Most functionality
necessary is already be provided by <code>crnk-core</code>. The steps include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>implement <code>HttpRequestContextBase</code>.</p>
</li>
<li>
<p>instantiate <code>CrnkBoot</code> to setup crnk.</p>
</li>
<li>
<p>get the <code>RequestDispatcher</code> from <code>CrnkBoot</code>.</p>
</li>
<li>
<p>invoke the <code>RequestDispatcher</code> for each incoming request with the implemented
<code>HttpRequestContextBase</code>.</p>
</li>
<li>
<p>you may want to further implement <code>SecurityProvider</code>, <code>TransactionRunner</code>
and <code>PropertiesProvider</code> to interface with that particular systems.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generation">8. Generation</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
this feature is still in incurbation, feedback and contributions welcomed. In particular further frameworks like
Spring must be supported.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Crnk allows the generation of Typescript stubs for type-safe, client-side web development. Contributions for other
languages like iOS would be very welcomed.</p>
</div>
<div class="sect2">
<h3 id="_typescript">8.1. Typescript</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Available soon (ngrx-json-api needs to be released as well)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Typescript generator allows the generation of JSON API resources, repositories and related objects such as meta
information, links information, data objects, list types and enumeration types. Currently the generator targets the
&lt;a href="https://github.com/abdulhaq-e/ngrx-json-api"&gt;ngrx-json-api&lt;/a&gt; library. Support for other libraries/formats
would be fairly straightforward to add, contributions welcomed. A generated resource looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>import {Task} from './task'
import {ResourceRelationship, StoreResource, TypedManyResourceRelationship, TypedOneResourceRelationship} from 'ngrx-json-api'

export module Schedule{
	export interface Relationships{
		[key: string]: ResourceRelationship;
		task?: TypedOneResourceRelationship&lt;Task&gt;;
		lazyTask?: TypedOneResourceRelationship&lt;Task&gt;;
		tasks?: TypedManyResourceRelationship&lt;Task&gt;;
		tasksList?: TypedManyResourceRelationship&lt;Task&gt;;
	}
	export interface Attributes{
		name?: string;
		delayed?: boolean;
	}
}
export interface Schedule extends StoreResource{
	relationships?: Schedule.Relationships;
	attributes?: Schedule.Attributes;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Internally the generator has to make use of the running application to gather the necessary information for generation. This
approach not only supports the regular resources and repositories manually implemented by the application,
but also more advanced patterns like resources obtained through third-party modules or derived from JPA entities. To get the
application to a running state at built-time, the generator makes use of the JUnit setup of the application.
So far supported are a setup of JUnit with Deltaspike for JEE application. Other non-CDI integrations like Spring to follow soon.</p>
</div>
<div class="paragraph">
<p>A setup may look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>buildscript {
	dependencies {
		classpath "io.crnk:crnk-gen-typescript:${version}"
	}
}

apply plugin: 'io.crnk.typescriptGen'

typescriptGen.npmPackageName = '@crnk/typescript-demo'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Two configurations are necessary:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>npmPackageName</code> to use for publishing.</p>
</li>
<li>
<p>a mapping of meta (package) ids to npm packages. Only resources are generated whose package matches the chosen <code>npmPackageName</code>.
All other resources are imported as external NPM dependency.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>crnk-meta is used to get a meta model of the underlying resources (or a any other type of object like JPA entities).
Important to know is that every object is assigned a string-based meta id. For typical, simpler use cases this matches
the class name. But for more advanced use cases those may or can differ.</p>
</div>
<div class="paragraph">
<p>TODO show publishing setup into NPM repository</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_faq">9. FAQ</h2>
<div class="sectionbody">
<div class="qlist qanda">
<ol>
<li>
<p><em>How to do Cors with Crnk?</em></p>
<p>In most cases if not all cases Cors should be setup in the underyling
integration, like with the Servlet-API or as JAX-RS filter and
not within Crnk itself. This allows to make use of the native
Cors mechanisms of an integration and to share Cors handling with
the other parts of the application.</p>
</li>
<li>
<p><em>Is Swagger supported by Crnk?</em></p>
<p>Have a look at <a href="http://www.crnk.io/related/" class="bare">http://www.crnk.io/related/</a>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-06-05 11:20:55 +02:00
</div>
</div>
</body>
</html>